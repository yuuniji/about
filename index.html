<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>叶泽伟的作品集</title>
    <style>
        /* ===== Base Styles ===== */
        body {
            font-family: Menlo, Monaco, 'Courier New', monospace;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
            color: #23272e;
            min-height: 100vh;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, color 0.3s;
            position: relative;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ===== Particles Background ===== */
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* ===== Language Switcher ===== */
        .lang-switcher {
            position: fixed;
            top: 18px;
            left: 32px;
            z-index: 10;
        }

        .lang-switcher button {
            background: none;
            border: none;
            color: #666;
            font-size: 14px;
            margin: 0 5px;
            cursor: pointer;
            text-decoration: underline;
            font-family: inherit;
            transition: color 0.2s;
        }

        .lang-switcher button:hover {
            color: #23272e;
            text-decoration: none;
        }

        /* ===== Terminal Window ===== */
        .terminal-window {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.02),
                0 4px 8px rgba(0, 0, 0, 0.02),
                0 8px 16px rgba(0, 0, 0, 0.02),
                0 16px 32px rgba(0, 0, 0, 0.02),
                0 0 0 1px rgba(0, 0, 0, 0.05);
            max-width: 1120px;
            width: 95vw;
            margin: 20px auto;
            overflow: hidden;
            border: 1.5px solid rgba(224, 227, 231, 0.8);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            will-change: transform, opacity;
            animation: terminalAppear 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            max-height: 85vh;
            min-height: 300px;
        }

        /* ===== Terminal Bar ===== */
        .terminal-bar {
            background: #f5f7fa;
            height: 36px;
            display: flex;
            align-items: center;
            padding: 0 18px;
            border-bottom: 1px solid #e0e3e7;
            position: relative;
            transition: background 0.3s, border-color 0.3s;
        }

        .mac-btn {
            display: inline-block;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            margin-right: 7px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            transition: transform 0.2s, opacity 0.2s;
        }

        .mac-btn:hover {
            transform: scale(1.1);
            opacity: 0.8;
        }

        .mac-btn-group {
            display: flex;
            align-items: center;
            gap: 7px;
            position: absolute;
            left: 18px;
            z-index: 3;
        }

        .mac-btn-group.placeholder {
            width: 47px;
            min-width: 47px;
            max-width: 47px;
            visibility: hidden;
            pointer-events: none;
            margin-right: 0;
        }

        .mac-close { background: #ff5f56; }
        .mac-min { background: #ffbd2e; }
        .mac-max { 
            background: #27c93f;
            margin-right: 0;
        }

        /* ===== Terminal Content ===== */
        .terminal-content {
            padding: 32px 30px 28px 30px;
            position: relative;
            transition: padding 0.3s;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
            flex-grow: 1;
        }

        .terminal-content::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .terminal-content::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* ===== Terminal Title ===== */
        .terminal-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            font-family: inherit;
            font-weight: 500;
            color: #23272e;
            background: transparent;
            border: none;
            letter-spacing: 0.5px;
            text-shadow: none;
            user-select: text;
            z-index: 2;
            height: 100%;
            display: flex;
            align-items: center;
            white-space: nowrap;
            text-overflow: ellipsis;
            opacity: 1;
            padding: 0 8px;
        }

        /* ===== Clock ===== */
        .clock {
            position: absolute;
            right: 18px;
            font-size: 14px;
            color: #666;
            font-family: inherit;
            white-space: nowrap;
            transition: all 0.3s ease;
            z-index: 3;
        }

        /* ===== Terminal Cursor ===== */
        .terminal-cursor {
            display: inline-block;
            width: 0.85em;
            height: 1.1em;
            background: none;
            color: #27c93f;
            font-weight: bold;
            font-size: 1em;
            animation: blink 1s steps(1) infinite;
            vertical-align: middle;
            transition: color 0.3s;
            will-change: opacity;
        }

        /* ===== Terminal History ===== */
        .terminal-history {
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
            font-size: 15px;
            color: #e3e5e8;
            background: transparent;
            padding: 0;
            margin: 0;
            min-height: 220px;
            line-height: 1.6;
            letter-spacing: 0.01em;
            overflow-y: visible;
        }
        /* ===== Responsive Link List (Projects/Blog) ===== */
        .link-list {
            display: table;
            width: 100%;
            table-layout: fixed;
            margin: 10px 0 18px 0;
        }
        .link-row {
            display: table-row;
        }
        .link-item {
            display: table-cell;
            width: 50%;
            vertical-align: top;
            padding-right: 16px;
        }
        .link-item a {
            display: block;
            width: 100%;
            box-sizing: border-box;
            word-break: break-all;
        }
        @media (max-width: 700px) {
            .link-list {
                display: block;
            }
            .link-row {
                display: block;
            }
            .link-item {
                display: block;
                width: 100%;
                padding-right: 0;
            }
        }

        .term-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            padding: 2px 0;
            word-break: break-all;
            opacity: 0;
            transform: translateY(16px);
            will-change: transform, opacity;
            animation: rowAppear 0.5s cubic-bezier(0.43, 0.13, 0.23, 0.96) forwards;
            transition: background 0.2s;
            border-radius: 4px;
        }
        .term-row:focus-within, .term-row:focus {
    background: #eaf6ff;
    outline: 1.5px solid #4dabff;
    box-shadow: none;
}

        @media (max-width: 600px) {
            .term-row {
                margin-bottom: 4px;
                font-size: 14px;
                padding: 1px 0;
            }
        }

        .term-prompt {
            color: #27c93f;
            font-weight: bold;
            margin-right: 7px;
            flex-shrink: 0;
            user-select: none;
            transition: color 0.3s;
        }

        .term-cmd {
            color: #23272e;
            font-weight: 500;
            transition: color 0.3s;
        }

        .term-output {
            color: #0056b3;
            margin-left: 28px;
            white-space: pre-line;
            word-break: break-all;
            transition: color 0.3s, margin 0.3s;
        }

        .term-output a {
    color: #0056b3;
    text-decoration: none;
    margin-right: 18px;
    font-size: 15px;
    position: relative;
    padding: 2px 6px;
    border-radius: 4px;
    display: inline-block;
    background: none;
    outline: none;
    transition: background 0.15s, color 0.15s, box-shadow 0.15s;
}

.term-output a:hover,
.term-output a:focus {
    background: #eaf6ff;
    color: #23272e;
    text-decoration: none;
    box-shadow: 0 0 0 1.5px #4dabff;
    outline: none;
}

.term-output a::before {
    content: attr(data-index);
    position: absolute;
    left: -20px;
    color: #666;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.15s;
}

.term-output a:hover::before,
.term-output a:focus::before {
            opacity: 1;
        }

        /* ===== Navigation Hint ===== */
        .nav-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            z-index: 1000;
            will-change: opacity;
        }

        .nav-hint.visible {
            opacity: 1;
        }

        /* ===== Animations ===== */
        @keyframes terminalAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes rowAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== Dark Mode Styles ===== */
        @media (prefers-color-scheme: dark) {
            body {
                background: #23272e;
                color: #e3e5e8;
            }

            .terminal-window {
                background: rgba(24, 24, 24, 0.95);
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.1),
                    0 4px 8px rgba(0, 0, 0, 0.1),
                    0 8px 16px rgba(0, 0, 0, 0.1),
                    0 16px 32px rgba(0, 0, 0, 0.1),
                    0 0 0 1px rgba(255, 255, 255, 0.05);
                border: 1.5px solid rgba(255, 255, 255, 0.1);
            }

            .terminal-bar {
                background: #1a1a1a;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .terminal-title {
                color: #e3e5e8;
            }

            .lang-switcher button {
                color: #bdbdbd;
            }

            .lang-switcher button:hover {
                color: #fff;
            }

            .clock {
                color: #bdbdbd;
            }

            .terminal-content::-webkit-scrollbar-thumb {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .term-output a::before {
                color: #bdbdbd;
            }
            .term-output a:hover,
            .term-output a:focus {
                background: #253040;
                color: #e3e5e8;
                box-shadow: 0 0 0 1.5px #4dabff;
            }
            .term-row:focus-within, .term-row:focus {
                background: #253040;
                outline: 1.5px solid #4dabff;
            }

            .term-cmd {
                color: #e3e5e8;
            }

            .nav-hint {
                background: rgba(77, 171, 255, 0.1);
                color: #4dabff;
                border-color: rgba(77, 171, 255, 0.2);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }
        }

        /* ===== Responsive Styles ===== */
        @media (max-width: 900px) {
            .terminal-window {
                max-width: 98vw;
                width: 98vw;
                margin: 12px auto;
                border-radius: 10px;
            }
            .terminal-title {
                font-size: 15px;
            }
            .clock {
                font-size: 13px;
            }
            .lang-switcher {
                top: 10px;
                left: 10px;
            }
        }
        @media (max-width: 768px) {
            .terminal-title {
                font-size: 15px;
                max-width: calc(100% - 160px);
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .clock {
                right: 80px;
                font-size: 12px;
            }
        }
        @media (max-width: 600px) {
            .terminal-window {
                margin: 8px auto;
                width: 99vw;
                border-radius: 8px;
                min-height: 220px;
                max-height: 95vh;
            }
            .terminal-content {
                padding: 12px 4vw;
            }
            .terminal-bar {
                height: 30px;
                padding: 0 8px;
            }
            .mac-btn {
                width: 10px;
                height: 10px;
                margin-right: 4px;
            }
            .mac-btn-group {
                left: 8px;
            }
            .terminal-title {
                font-size: 13px;
            }
            .clock {
                right: 8px;
                font-size: 11px;
            }
            .lang-switcher {
                top: 4px;
                left: 4px;
            }
            .term-output a::before {
                left: -16px;
                font-size: 11px;
            }
            .term-output a:hover,
            .term-output a:focus {
                background: #eaf6ff;
                color: #23272e;
                box-shadow: 0 0 0 1.5px #4dabff;
            }
            .term-row:focus-within, .term-row:focus {
                background: #eaf6ff;
                outline: 1.5px solid #4dabff;
            }
            .nav-hint {
                font-size: 12px;
                padding: 6px 12px;
                bottom: 10px;
            }
        }
        @media (max-width: 400px) {
            .terminal-window {
                margin: 4px auto;
                width: 100vw;
                border-radius: 5px;
            }
            .terminal-content {
                padding: 8px 2vw;
            }
            .terminal-bar {
                height: 24px;
                padding: 0 4px;
            }
            .mac-btn {
                width: 9px;
                height: 9px;
                margin-right: 3px;
            }
            .mac-btn-group {
                left: 4px;
            }
            .terminal-title {
                font-size: 10px;
            }
            .clock {
                right: 4px;
                font-size: 9px;
            }
            .lang-switcher {
                top: 2px;
                left: 2px;
            }
        }
        @media (max-width: 320px) {
            .terminal-title {
                font-size: 9px;
                max-width: calc(100% - 10px);
            }
            .clock {
                display: none;
            }
        }

        /* ===== Safari Specific Styles ===== */
        @supports (-webkit-touch-callout: none) {
            .terminal-window {
                background: rgba(255, 255, 255, 0.98);
            }
            
            @media (prefers-color-scheme: dark) {
                .terminal-window {
                    background: rgba(24, 24, 24, 0.98);
                }
            }
        }
    </style>
</head>

<body>
    <div id="particles-js"></div>
    <div class="lang-switcher">
        <button onclick="changeLanguage('zh')">中文</button>
        <button onclick="changeLanguage('en')">English</button>
        <button onclick="changeLanguage('ja')">日本語</button>
    </div>

    <div class="terminal-window">
        <div class="terminal-bar">
            <div class="mac-btn-group">
                <div class="mac-btn mac-close"></div>
                <div class="mac-btn mac-min"></div>
                <div class="mac-btn mac-max"></div>
            </div>
            <div id="title" class="terminal-title">叶泽伟的作品集</div>
            <div id="clock" class="clock"></div>
        </div>
        <div class="terminal-content">
            <div id="terminal-history"></div>
        </div>
    </div>

    <div id="nav-hint" class="nav-hint"></div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
    // 全局JS错误捕获，方便调试
    window.onerror = function(msg, url, line, col, error) {
        alert('JS错误: ' + msg + '\n' + url + ':' + line + (col ? (':' + col) : ''));
        return false;
    }
    </script>
    <script>
        // 初始化粒子动画
        particlesJS('particles-js', {
            particles: {
                number: {
                    value: 80,
                    density: {
                        enable: true,
                        value_area: 800
                    }
                },
                color: {
                    value: '#27c93f'
                },
                shape: {
                    type: 'circle'
                },
                opacity: {
                    value: 0.5,
                    random: true,
                    anim: {
                        enable: true,
                        speed: 1,
                        opacity_min: 0.1,
                        sync: false
                    }
                },
                size: {
                    value: 3,
                    random: true
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#27c93f',
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: 'none',
                    random: true,
                    straight: false,
                    out_mode: 'out',
                    bounce: false
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: {
                        enable: true,
                        mode: 'grab'
                    },
                    onclick: {
                        enable: true,
                        mode: 'push'
                    },
                    resize: true
                },
                modes: {
                    grab: {
                        distance: 140,
                        line_linked: {
                            opacity: 1
                        }
                    },
                    push: {
                        particles_nb: 4
                    }
                }
            },
            retina_detect: true
        });

        // 根据系统主题切换粒子颜色
        function updateParticleColor(isDark) {
            const color = isDark ? '#4dabff' : '#27c93f';
            const particles = window.pJSDom[0].pJS.particles;
            particles.color.value = color;
            particles.line_linked.color = color;
            window.pJSDom[0].pJS.fn.particlesRefresh();
        }

        // 监听系统主题变化
        const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkModeMediaQuery.addListener((e) => {
            updateParticleColor(e.matches);
        });
        updateParticleColor(darkModeMediaQuery.matches);

        // Data for projects and blog posts
        const data = {
            projects: [
                {
                    url: "https://yuuniji.github.io/fitplan/",
                    label: {
                        zh: "04 - 每周徒手增肌计划",
                        en: "04 - Weekly Bodyweight Workout Plan",
                        ja: "04 - 毎週の自重筋トレ計画"
                    }
                },
                {
                    url: "https://yuuniji.github.io/smart-tooltip/",
                    label: {
                        zh: "03 - 智能定位的注释系统",
                        en: "03 - Smart Tooltip System with Intelligent Positioning",
                        ja: "03 - インテリジェント位置決め付きツールチップシステム"
                    }
                },
                {
                    url: "https://yuuniji.github.io/",
                    label: {
                        zh: "02 - 个人博客网站",
                        en: "02 - Personal Blog Website",
                        ja: "02 - 個人ブログサイト"
                    }
                },
                {
                    url: "https://yuuniji.github.io/about/",
                    label: {
                        zh: "01 - 个人简介与作品集",
                        en: "01 - About & Portfolio",
                        ja: "01 - 自己紹介とポートフォリオ"
                    }
                }
            ],
            blog: [
                {
                    url: "https://yuuniji.github.io/posts/reading-0-overview/",
                    label: {
                        zh: "10 - 《阅读日志》系列",
                        en: "10 - 'BookLog' Series",
                        ja: "10 - 『読書ログ』シリーズ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/roadmap-kubernetes/",
                    label: {
                        zh: "09 - Kubernetes 路线图",
                        en: "09 - Kubernetes Roadmap",
                        ja: "09 - Kubernetesのロードマップ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/roadmap-docker/",
                    label: {
                        zh: "08 - Docker 路线图",
                        en: "08 - Docker Roadmap",
                        ja: "08 - Dockerのロードマップ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/roadmap-terraform/",
                    label: {
                        zh: "07 - Terraform 路线图",
                        en: "07 - Terraform Roadmap",
                        ja: "07 - Terraformのロードマップ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/roadmap-git-github/",
                    label: {
                        zh: "06 - Git 和 GitHub 路线图",
                        en: "06 - Git and GitHub Roadmap",
                        ja: "06 - GitとGitHubのロードマップ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/roadmap-go/",
                    label: {
                        zh: "05 - Go 路线图",
                        en: "05 - Go Roadmap",
                        ja: "05 - Goのロードマップ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/roadmap-devops/",
                    label: {
                        zh: "04 - DevOps 路线图",
                        en: "04 - DevOps Roadmap",
                        ja: "04 - DevOpsのロードマップ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/python-0-overview/",
                    label: {
                        zh: "03 - 《如何学好Python》系列",
                        en: "03 - 'How to Learn Python Effectively' Series",
                        ja: "03 - 『Pythonを上手に学ぶ方法』シリーズ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/how-to-learn-japanese-effectively-0-overview/",
                    label: {
                        zh: "02 - 《如何学好日语》系列",
                        en: "02 - 'How to Learn Japanese Effectively' Series",
                        ja: "02 - 『日本語を上手に学ぶ方法』シリーズ"
                    }
                },
                {
                    url: "https://yuuniji.github.io/posts/my-first-post/",
                    label: {
                        zh: "01 - 我的博客搭建",
                        en: "01 - Building My Blog",
                        ja: "01 - 私のブログ構築"
                    }
                }
            ]
        };

        // Translations for static text (title and headings)
        const translations = {
            zh: {
                title: "叶泽伟的作品集",
                projectsHeading: "项目",
                blogHeading: "博客"
            },
            en: {
                title: "Zewai Ye's Portfolio",
                projectsHeading: "Projects",
                blogHeading: "Blog"
            },
            ja: {
                title: "葉澤偉のポートフォリオ",
                projectsHeading: "プロジェクト",
                blogHeading: "ブログ"
            }
        };

        // Function to render the content based on language
        function renderContent(lang) {
            const content = translations[lang];

            // Update page title
            document.title = content.title;
            // Terminal title栏显示（带光标）
            const titleEl = document.getElementById('title');
            titleEl.setAttribute('title', content.title);
            titleEl.innerHTML = `${content.title}<span class="terminal-cursor">▋</span>`;

            // 渲染终端历史
            renderTerminalHistory(lang);
        }

        // 仿终端命令历史逻辑
        // 全局变量用于终止动画
        let terminalHistoryTimer = null;
        // fallbackMode: true时直接输出全部内容，无动画
        function renderTerminalHistory(lang, fallbackMode) {
            const historyEl = document.getElementById('terminal-history');
            historyEl.innerHTML = '';
            if (terminalHistoryTimer) {
                clearTimeout(terminalHistoryTimer);
                terminalHistoryTimer = null;
            }
            // fallback: 若异常直接全部输出
            try {
            const dirNames = {
                zh: { project: '项目', blog: '博客' },
                en: { project: 'Projects', blog: 'Blog' },
                ja: { project: 'プロジェクト', blog: 'ブログ' }
            };
            const dirs = dirNames[lang];
            const prompt = '<span class="term-prompt" aria-hidden="true">➜ ~ %</span>';
            const promptProjects = `<span class="term-prompt" aria-hidden="true">➜ ${dirs.project} %</span>`;
            const promptBlog = `<span class="term-prompt" aria-hidden="true">➜ ${dirs.blog} %</span>`;

            // 历史步骤
            // 仅用人名作为版权声明内容
        const nameText = {
            zh: '叶泽伟',
            en: 'Zewai Ye',
            ja: '葉澤偉'
        };
        const copyrightText = {
            zh: `© 2025 <a href="https://github.com/yuuniji" target="_blank" style="color:#888;text-decoration:none;">${nameText.zh}</a> 版权所有`,
            en: `© 2025 <a href="https://github.com/yuuniji" target="_blank" style="color:#888;text-decoration:none;">${nameText.en}</a>. All rights reserved.`,
            ja: `© 2025 <a href="https://github.com/yuuniji" target="_blank" style="color:#888;text-decoration:none;">${nameText.ja}</a> 全著作権所有`
        };

        const steps = [
                { type: 'cmd', prompt, cmd: 'ls', ariaLabel: 'List directories' },
                { type: 'output', output: `<a href="https://github.com/yuuniji" target="_blank" aria-label="${dirs.project} homepage" data-index="1">${dirs.project}</a>  <a href="https://yuuniji.github.io/" target="_blank" aria-label="${dirs.blog} homepage" data-index="2">${dirs.blog}</a>` },
                { type: 'cmd', prompt: promptProjects, cmd: `cd ~/${dirs.project} && ls`, ariaLabel: `Change to ${dirs.project} directory and list contents` },
                { type: 'output', output: `<div class=\"link-list\">` +
                        data.projects.reduce((acc, prj, idx, arr) => {
                            if (idx % 2 === 0) acc += '<div class=\"link-row\">';
                            acc += `<div class=\"link-item\"><a href=\"${prj.url}\" target=\"_blank\" aria-label=\"${prj.label[lang]}\" data-index=\"${idx + 1}\">${prj.label[lang]}</a></div>`;
                            if (idx % 2 === 1 || idx === arr.length - 1) acc += '</div>';
                            return acc;
                        }, '') + `</div>` },
                { type: 'cmd', prompt: promptBlog, cmd: `cd ~/${dirs.blog} && ls`, ariaLabel: `Change to ${dirs.blog} directory and list contents` },
                { type: 'output', output: `<div class=\"link-list\">` +
                        data.blog.reduce((acc, blog, idx, arr) => {
                            if (idx % 2 === 0) acc += '<div class=\"link-row\">';
                            acc += `<div class=\"link-item\"><a href=\"${blog.url}\" target=\"_blank\" aria-label=\"${blog.label[lang]}\" data-index=\"${idx + 1}\">${blog.label[lang]}</a></div>`;
                            if (idx % 2 === 1 || idx === arr.length - 1) acc += '</div>';
                            return acc;
                        }, '') + `</div>` },
                // 版权声明（多语言）
                { type: 'output', output: `<span style=\"color:#888;opacity:0.55;font-size:13px;\">${copyrightText[lang]}</span>` }
            ];

            if (fallbackMode) {
                // 直接输出所有内容，无动画
                steps.forEach(s => {
                    let row = document.createElement('div');
                    row.className = 'term-row';
                    if (s.type === 'cmd') {
                        row.innerHTML = s.prompt + ' <span class="term-cmd">' + s.cmd + '</span>';
                    } else {
                        row.innerHTML = `<div class="term-output" role="list">${s.output}</div>`;
                    }
                    historyEl.appendChild(row);
                });
                historyEl.scrollTop = historyEl.scrollHeight;
                return;
            }
            let i = 0;
            function typeCommand(row, prompt, cmd, ariaLabel, cb) {
                row.innerHTML = prompt + ' <span class="term-cmd" aria-label="' + ariaLabel + '"></span><span class="terminal-cursor" aria-hidden="true">▋</span>';
                const cmdSpan = row.querySelector('.term-cmd');
                const cursor = row.querySelector('.terminal-cursor');
                let idx = 0;
                function typeChar() {
                    if (idx <= cmd.length) {
                        cmdSpan.textContent = cmd.slice(0, idx);
                        cursor.style.display = 'inline-block';
                        historyEl.scrollTop = historyEl.scrollHeight;
                        idx++;
                        terminalHistoryTimer = setTimeout(typeChar, 17);
                    } else {
                        if (cursor && cursor.parentNode) cursor.parentNode.removeChild(cursor);
                        if (cb) cb();
                    }
                }
                typeChar();
            }

            function nextStep() {
                if (i >= steps.length) return;
                const s = steps[i];
                let row = document.createElement('div');
                row.className = 'term-row';
                if (s.type === 'cmd') {
                    historyEl.appendChild(row);
                    typeCommand(row, s.prompt, s.cmd, s.ariaLabel, function () {
                        i++;
                        terminalHistoryTimer = setTimeout(nextStep, 120);
                    });
                } else {
                    row.innerHTML = `<div class="term-output" role="list">${s.output}</div>`;
                    historyEl.appendChild(row);
                    historyEl.scrollTop = historyEl.scrollHeight;
                    i++;
                    terminalHistoryTimer = setTimeout(nextStep, 420);
                }
            }
            nextStep();
            } catch (e) {
                historyEl.innerHTML = '<div style="color:red">内容渲染失败: ' + e.message + '</div>';
            }
        }

        // 星期翻译
        const weekdays = {
            zh: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
            en: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
            ja: ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日']
        };

        // 更新时钟
        function updateClock(lang) {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const weekday = weekdays[lang][now.getDay()];
            const clockEl = document.getElementById('clock');
            clockEl.textContent = `${hours}:${minutes} ${weekday}`;
        }

        // 初始化时钟并设置定时器
        let currentLang = 'zh';
        updateClock(currentLang);
        setInterval(() => updateClock(currentLang), 60000); // 每分钟更新一次

        // 修改导航提示的翻译
        const navHints = {
            zh: {
                hint: "提示：使用 Tab 键在元素间导航，使用方向键上下选择项目，回车键确认"
            },
            en: {
                hint: "Tip: Use Tab key to navigate between elements, use arrow keys to select items, press Enter to confirm"
            },
            ja: {
                hint: "ヒント：Tabキーで要素間を移動、矢印キーで項目を選択、Enterキーで確定"
            }
        };

        // 修改语言切换函数
        function changeLanguage(lang) {
            currentLang = lang;
            // 保存语言选择到 localStorage
            localStorage.setItem('preferredLanguage', lang);
            renderContent(lang);
            updateClock(lang);
            updateNavHint(lang);
        }

        // 添加更新导航提示的函数
        function updateNavHint(lang) {
            const hintEl = document.getElementById('nav-hint');
            hintEl.textContent = navHints[lang].hint;
            hintEl.classList.add('visible');
            
            // 5秒后隐藏提示
            setTimeout(() => {
                hintEl.classList.remove('visible');
            }, 5000);
        }

        // 修改初始化函数，确保在 Safari 中正确加载
        function init() {
            // 确保 DOM 完全加载
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeContent);
            } else {
                initializeContent();
            }
        }

        function initializeContent() {
            // 获取浏览器语言
            const browserLang = navigator.language || navigator.userLanguage;
            // 从 localStorage 获取保存的语言设置
            let savedLang = localStorage.getItem('preferredLanguage');

            // 语言映射表（将浏览器语言代码映射到我们的支持的语言）
            const langMap = {
                'zh': 'zh',
                'zh-CN': 'zh',
                'zh-TW': 'zh',
                'zh-HK': 'zh',
                'en': 'en',
                'en-US': 'en',
                'en-GB': 'en',
                'ja': 'ja',
                'ja-JP': 'ja'
            };

            // 获取浏览器语言的基础代码（例如 'zh-CN' -> 'zh'）
            const baseLang = browserLang.split('-')[0];

            // 检查localStorage非法语言代码
            if (savedLang && !['zh','en','ja'].includes(savedLang)) {
                localStorage.removeItem('preferredLanguage');
                savedLang = null;
            }

            // 确定初始语言
            let initialLang;
            if (savedLang) {
                initialLang = savedLang;
            } else if (langMap[browserLang]) {
                initialLang = langMap[browserLang];
            } else if (langMap[baseLang]) {
                initialLang = langMap[baseLang];
            } else {
                initialLang = 'zh';
            }

            currentLang = initialLang;

            // 确保在渲染内容之前所有必要的元素都已存在
            const titleEl = document.getElementById('title');
            const historyEl = document.getElementById('terminal-history');
            const clockEl = document.getElementById('clock');

            if (titleEl && historyEl && clockEl) {
                try {
                    renderContent(initialLang);
                    updateNavHint(initialLang);
                    initializeKeyboardNavigation();
                    // fallback: 如果1s后内容还没出来，直接输出全部内容
                    setTimeout(function() {
                        if (!historyEl.innerHTML || historyEl.innerHTML.trim() === '') {
                            renderTerminalHistory(initialLang, true);
                        }
                    }, 1200);
                } catch (e) {
                    historyEl.innerHTML = '<div style="color:red">内容渲染失败: ' + e.message + '</div>';
                }
            } else {
                setTimeout(initializeContent, 100);
            }
        }

        function initializeKeyboardNavigation() {
            let currentFocusIndex = -1;
            const focusableElements = document.querySelectorAll('a, button');
            
            // 添加键盘事件监听
            document.addEventListener('keydown', function(e) {
                // 显示导航提示
                const hintEl = document.getElementById('nav-hint');
                hintEl.classList.add('visible');
                
                // 重置隐藏计时器
                clearTimeout(hintEl.hideTimer);
                hintEl.hideTimer = setTimeout(() => {
                    hintEl.classList.remove('visible');
                }, 5000);

                // Tab 键导航
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const currentIndex = Array.from(focusableElements).indexOf(document.activeElement);
                    let nextIndex;

                    if (e.shiftKey) {
                        nextIndex = currentIndex > 0 ? currentIndex - 1 : focusableElements.length - 1;
                    } else {
                        nextIndex = currentIndex < focusableElements.length - 1 ? currentIndex + 1 : 0;
                    }

                    focusableElements[nextIndex].focus();
                    currentFocusIndex = nextIndex;
                }

                // 方向键导航
                if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    const links = document.querySelectorAll('.term-output a');
                    
                    if (links.length === 0) return;

                    if (currentFocusIndex === -1) {
                        currentFocusIndex = e.key === 'ArrowDown' ? 0 : links.length - 1;
                    } else {
                        if (e.key === 'ArrowUp') {
                            currentFocusIndex = currentFocusIndex > 0 ? currentFocusIndex - 1 : links.length - 1;
                        } else {
                            currentFocusIndex = currentFocusIndex < links.length - 1 ? currentFocusIndex + 1 : 0;
                        }
                    }

                    links[currentFocusIndex].focus();
                }

                // 回车键确认
                if (e.key === 'Enter' && document.activeElement.tagName === 'A') {
                    document.activeElement.click();
                }

                // 数字键快速导航（仅当项目数量小于等于9个时）
                if (e.key >= '1' && e.key <= '9') {
                    const num = parseInt(e.key);
                    const links = document.querySelectorAll('.term-output a');
                    if (num <= links.length && links.length <= 9) {
                        links[num - 1].focus();
                        links[num - 1].click();
                    }
                }
            });
        }

        // 初始化
        init();
    </script>
</body>

</html>
